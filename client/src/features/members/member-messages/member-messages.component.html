<div class="flex flex-col h-full">

  <!-- MESSAGE LIST -->
  <div class="flex-1 overflow-y-auto px-2 space-y-4">

    @for (item of messageService.messageThread(); track item.id) {
      <div
        class="chat"
        [class.chat-start]="item.senderId === memberService.member()?.id"
        [class.chat-end]="item.senderId !== memberService.member()?.id"
      >
        <div
          class="chat-image avatar"
          [class.avatar-online]="
            presenceService.onlineUsers().includes(item.senderId || item.recipientId)
          "
        >
          <div class="w-10 h-10 rounded-full overflow-hidden">
            <img
              [src]="item.senderImageUrl || 'default_user.jpg'"
              class="w-full h-full object-cover"
            />
          </div>
        </div>

        <div class="chat-header">
          {{ item.senderDisplayName }}
          <time class="text-xs opacity-50 ml-2">
            {{ item.messageSent | date: 'd/M/yyyy, h:mm a' }}
          </time>
        </div>

        <div class="chat-bubble">
          {{ item.content }}
        </div>

        <div class="chat-footer opacity-50">
          @if (item.currentUserSender && item.dateRead) {
            Seen {{ item.dateRead | timeAgo }}
          } @else if (item.currentUserSender && !item.dateRead) {
            Not read
          }
        </div>
      </div>
    }

    <div #messageEndRef></div>
  </div>

  <!-- INPUT SECTION -->
  <!-- <div class="border-t border-base-300 bg-base-100 p-3">
    <div class="flex gap-2">
      <input
        [(ngModel)]="messageContent"
        class="input input-bordered w-full"
        placeholder="Enter your message"
        (keydown.enter)="sendMessage()"
      />
      <button
        (click)="sendMessage()"
        class="btn btn-primary"
      >
        Send
      </button>
    </div>
  </div> -->

   <!-- Textbox -->
  <div class="mt-auto border-t border-base-300 bg-base-100 pb-0 mb-0">
    <div class="flex gap-2">
      <input
        [(ngModel)]="messageContent"
        class="input input-bordered w-full"
        placeholder="Enter your message"
        (keydown.enter)="sendMessage()"
      />
      <button
        (click)="sendMessage()"
        class="btn btn-primary"
      >
        Send
      </button>
    </div>
  </div>
</div>